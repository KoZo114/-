<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ê°úËàû„ÅÜÁ©∫„Ç≠„É£„ÉÉ„ÉÅ„Ç≤„Éº„É† - Á©∂Ê•µÁâà</title>
  <style>
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');

    body {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      position: relative;
      background: linear-gradient(135deg, 
        #ffeef5 0%, #ffe8f0 25%, #f8e8ff 50%, #e8f0ff 75%, #f0f8ff 100%
      );
      font-family: 'Noto Sans JP', sans-serif;
      touch-action: manipulation;
      -webkit-overflow-scrolling: touch;
    }

    /* „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ËÉåÊôØÂäπÊûú */
    .bg-particle {
      position: absolute;
      background: rgba(255, 182, 193, 0.3);
      border-radius: 50%;
      pointer-events: none;
      animation: float-bg linear infinite;
      z-index: 0;
    }

    @keyframes float-bg {
      0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
    }

    #character {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      max-height: 25vh;
      max-width: 120px;
      z-index: 5;
      filter: drop-shadow(2px 4px 8px rgba(0,0,0,0.2));
      transition: all 0.3s ease;
    }

    #character.jump {
      animation: jump 0.6s ease;
    }

    #character.powerup {
      filter: drop-shadow(0 0 15px #FFD700) drop-shadow(2px 4px 8px rgba(0,0,0,0.2));
      transform: translateX(-50%) scale(1.1);
    }

    @keyframes jump {
      0%   { transform: translateX(-50%) translateY(0); }
      30%  { transform: translateX(-50%) translateY(-60px); }
      60%  { transform: translateX(-50%) translateY(-60px); }
      100% { transform: translateX(-50%) translateY(0); }
    }

    /* Êñ∞„Åó„ÅÑ„Ç¢„Ç§„ÉÜ„É†„Çø„Ç§„Éó */
    .petal {
      position: absolute;
      width: 35px;
      height: 35px;
      background: radial-gradient(ellipse at center, 
        #ffb3d9 0%, #ffc9e0 40%, #ffe0f0 80%, rgba(255, 192, 224, 0.8) 100%
      );
      border-radius: 50% 10% 50% 10%;
      box-shadow: 
        0 2px 4px rgba(255, 105, 180, 0.3),
        inset 0 1px 2px rgba(255, 255, 255, 0.5);
      pointer-events: none;
      animation: fall linear;
      z-index: 1;
      filter: drop-shadow(0 0 3px rgba(255, 182, 193, 0.6));
    }

    .petal.special {
      width: 40px;
      height: 40px;
      background: radial-gradient(circle, #FFD700 0%, #FFA500 50%, #FF69B4 100%);
      filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.8));
      animation: fall-special linear;
    }

    .petal.golden {
      width: 45px;
      height: 45px;
      background: radial-gradient(circle, #FFD700 0%, #FFFF00 30%, #FFA500 70%, #FF4500 100%);
      filter: drop-shadow(0 0 15px rgba(255, 215, 0, 1)) drop-shadow(0 0 8px rgba(255, 255, 255, 0.8));
      animation: fall-golden linear;
      border: 2px solid rgba(255, 255, 255, 0.8);
    }

    .bomb {
      width: 40px;
      height: 40px;
      background: radial-gradient(circle, #FF0000 0%, #8B0000 70%, #000000 100%);
      border-radius: 50%;
      filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.8));
      animation: fall-bomb linear;
      position: relative;
    }

    .bomb::before {
      content: 'üí£';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 25px;
      animation: bomb-pulse 0.5s infinite alternate;
    }

    @keyframes bomb-pulse {
      0% { transform: translate(-50%, -50%) scale(1); }
      100% { transform: translate(-50%, -50%) scale(1.2); }
    }

    .power-up {
      width: 45px;
      height: 45px;
      background: linear-gradient(45deg, #9370DB, #4169E1, #00CED1, #32CD32, #FFD700);
      border-radius: 50%;
      filter: drop-shadow(0 0 15px rgba(147, 112, 219, 0.8));
      animation: fall-powerup linear;
      position: relative;
      animation-name: fall-powerup, rainbow-rotate;
      animation-duration: inherit, 1s;
      animation-iteration-count: 1, infinite;
      animation-timing-function: linear, ease-in-out;
    }

    .power-up::before {
      content: '‚≠ê';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 25px;
      animation: star-spin 2s linear infinite;
    }

    @keyframes star-spin {
      0% { transform: translate(-50%, -50%) rotate(0deg) scale(1); }
      50% { transform: translate(-50%, -50%) rotate(180deg) scale(1.2); }
      100% { transform: translate(-50%, -50%) rotate(360deg) scale(1); }
    }

    @keyframes rainbow-rotate {
      0% { filter: drop-shadow(0 0 15px rgba(147, 112, 219, 0.8)) hue-rotate(0deg); }
      100% { filter: drop-shadow(0 0 15px rgba(147, 112, 219, 0.8)) hue-rotate(360deg); }
    }

    @keyframes fall {
      0% { transform: translateY(-50px) rotate(0deg) scale(0.8); opacity: 0.6; }
      25% { opacity: 1; transform: translateY(25vh) rotate(90deg) scale(1); }
      50% { transform: translateY(50vh) rotate(180deg) scale(1.1); }
      75% { transform: translateY(75vh) rotate(270deg) scale(1); }
      100% { transform: translateY(100vh) rotate(360deg) scale(0.9); opacity: 0.8; }
    }

    @keyframes fall-special {
      0% { transform: translateY(-50px) rotate(0deg) scale(0.8); opacity: 0.8; }
      25% { opacity: 1; transform: translateY(25vh) rotate(90deg) scale(1.2); }
      50% { transform: translateY(50vh) rotate(180deg) scale(1.3); }
      75% { transform: translateY(75vh) rotate(270deg) scale(1.1); }
      100% { transform: translateY(100vh) rotate(360deg) scale(1); opacity: 0.9; }
    }

    @keyframes fall-golden {
      0% { transform: translateY(-50px) rotate(0deg) scale(0.9); opacity: 0.9; }
      25% { opacity: 1; transform: translateY(25vh) rotate(120deg) scale(1.3); }
      50% { transform: translateY(50vh) rotate(240deg) scale(1.4); }
      75% { transform: translateY(75vh) rotate(300deg) scale(1.2); }
      100% { transform: translateY(100vh) rotate(480deg) scale(1); opacity: 1; }
    }

    @keyframes fall-bomb {
      0% { transform: translateY(-50px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(180deg); opacity: 1; }
    }

    @keyframes fall-powerup {
      0% { transform: translateY(-50px) scale(0.8); opacity: 0.8; }
      25% { opacity: 1; transform: translateY(25vh) scale(1.1); }
      50% { transform: translateY(50vh) scale(1.2); }
      75% { transform: translateY(75vh) scale(1.1); }
      100% { transform: translateY(100vh) scale(1); opacity: 1; }
    }

    #scoreboard {
      position: fixed;
      top: 15px;
      right: 20px;
      font-size: 14px;
      font-weight: bold;
      color: #5a3d5c;
      background: linear-gradient(145deg, 
        rgba(255, 255, 255, 0.95) 0%,
        rgba(255, 240, 250, 0.9) 100%
      );
      padding: 15px 20px;
      border-radius: 20px;
      z-index: 10;
      line-height: 1.6;
      box-shadow: 
        0 8px 24px rgba(0, 0, 0, 0.15),
        0 4px 8px rgba(255, 105, 180, 0.2);
      border: 2px solid rgba(255, 182, 193, 0.4);
      backdrop-filter: blur(10px);
      min-width: 180px;
    }

    #level-display {
      position: fixed;
      top: 15px;
      left: 20px;
      font-size: 16px;
      font-weight: bold;
      color: #5a3d5c;
      background: linear-gradient(145deg, 
        rgba(255, 255, 255, 0.95) 0%,
        rgba(240, 248, 255, 0.9) 100%
      );
      padding: 12px 18px;
      border-radius: 15px;
      z-index: 10;
      box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.1),
        0 2px 4px rgba(65, 105, 225, 0.2);
      border: 2px solid rgba(100, 149, 237, 0.3);
      backdrop-filter: blur(5px);
    }

    .combo-display {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 24px;
      font-weight: bold;
      color: #FFD700;
      background: rgba(0, 0, 0, 0.8);
      padding: 10px 20px;
      border-radius: 15px;
      z-index: 15;
      display: none;
      animation: combo-pop 1s ease-out;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    @keyframes combo-pop {
      0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }

    #gameover {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 28px;
      font-weight: bold;
      background: linear-gradient(145deg, rgba(0,0,0,0.9), rgba(50,50,50,0.8));
      color: white;
      padding: 30px 50px;
      border-radius: 20px;
      display: none;
      z-index: 20;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .control-btn {
      position: fixed;
      bottom: 15px;
      width: 55px;
      height: 55px;
      font-size: 22px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(145deg, 
        rgba(255, 182, 193, 0.9) 0%,
        rgba(255, 105, 180, 0.8) 100%
      );
      color: white;
      z-index: 20;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      cursor: pointer;
      box-shadow: 
        0 6px 18px rgba(255, 105, 180, 0.4),
        0 3px 6px rgba(0, 0, 0, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.4);
      transition: all 0.2s ease;
    }

    .control-btn:active {
      transform: scale(0.95);
      box-shadow: 
        0 3px 9px rgba(255, 105, 180, 0.4),
        0 1px 3px rgba(0, 0, 0, 0.2);
    }

    /* „Éë„ÉØ„Éº„Ç¢„ÉÉ„ÉóÂäπÊûúË°®Á§∫ */
    .power-effect {
      position: fixed;
      bottom: 150px;
      left: 20px;
      background: linear-gradient(45deg, #9370DB, #4169E1);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      z-index: 15;
      display: none;
      animation: power-glow 0.5s ease-in-out infinite alternate;
    }

    @keyframes power-glow {
      0% { box-shadow: 0 0 10px rgba(147, 112, 219, 0.8); }
      100% { box-shadow: 0 0 20px rgba(147, 112, 219, 1); }
    }

    /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥ÊîπÂñÑ */
    @media (max-height: 600px) {
      #character {
        bottom: 90px;
        max-height: 20vh;
      }
      .control-btn {
        bottom: 10px;
        width: 50px;
        height: 50px;
        font-size: 20px;
      }
      #scoreboard {
        font-size: 12px;
        padding: 10px 15px;
      }
    }
    
    @media (max-height: 500px) {
      #character {
        bottom: 100px;
        max-height: 18vh;
      }
    }

    /* „É¨„Éô„É´„Ç¢„ÉÉ„Éó„Ç®„Éï„Çß„ÇØ„Éà */
    .level-up-effect {
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 32px;
      font-weight: bold;
      color: #FFD700;
      background: linear-gradient(45deg, rgba(255, 215, 0, 0.9), rgba(255, 140, 0, 0.8));
      padding: 20px 40px;
      border-radius: 20px;
      z-index: 25;
      display: none;
      animation: level-up-animation 2s ease-out;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      border: 3px solid rgba(255, 255, 255, 0.8);
    }

    @keyframes level-up-animation {
      0% { transform: translate(-50%, -50%) scale(0.5) rotate(-10deg); opacity: 0; }
      30% { transform: translate(-50%, -50%) scale(1.2) rotate(5deg); opacity: 1; }
      70% { transform: translate(-50%, -50%) scale(1.1) rotate(-2deg); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0; }
    }
  </style>
</head>
<body>
  <img id="character" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iIzRGOEZGRiIvPjx0ZXh0IHg9IjUwIiB5PSI1NSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iMTIiPuOCreODo+ODqeOCr+OCv+ODvDwvdGV4dD48L3N2Zz4=" alt="„Ç≠„É£„É©ÁîªÂÉè">
  
  <div id="scoreboard">
    „Çπ„Ç≥„Ç¢: <span id="score">0</span><br>
    „Éè„Ç§„Çπ„Ç≥„Ç¢: <span id="highscore">0</span><br>
    ÊÆã„Çä: <span id="timer">60</span>Áßí<br>
    „Ç≥„É≥„Éú: <span id="combo">0</span>
  </div>

  <div id="level-display">
    „É¨„Éô„É´: <span id="level">1</span>
  </div>

  <div class="combo-display" id="combo-display"></div>
  <div class="power-effect" id="power-effect"></div>
  <div class="level-up-effect" id="level-up-effect"></div>
  
  <div id="gameover">
    <div>„Ç≤„Éº„É†ÁµÇ‰∫ÜÔºÅ</div>
    <div style="font-size: 18px; margin-top: 10px;">
      ÊúÄÁµÇ„Çπ„Ç≥„Ç¢: <span id="final-score">0</span><br>
      Âà∞ÈÅî„É¨„Éô„É´: <span id="final-level">1</span>
    </div>
  </div>

  <script>
    // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆË®≠ÂÆöÔºàÈï∑Êäº„Åó„É°„Éã„É•„ÉºÈò≤Ê≠¢Ôºâ
    document.addEventListener('contextmenu', e => { e.preventDefault(); return false; }, { passive: false });
    document.addEventListener('selectstart', e => { e.preventDefault(); return false; }, { passive: false });
    document.addEventListener('dragstart', e => { e.preventDefault(); return false; }, { passive: false });

    // Ë¶ÅÁ¥†„ÅÆÂèñÂæó
    const character = document.getElementById("character");
    const scoreDisplay = document.getElementById("score");
    const highscoreDisplay = document.getElementById("highscore");
    const timerDisplay = document.getElementById("timer");
    const levelDisplay = document.getElementById("level");
    const comboDisplay = document.getElementById("combo");
    const comboPopup = document.getElementById("combo-display");
    const powerEffect = document.getElementById("power-effect");
    const levelUpEffect = document.getElementById("level-up-effect");
    const gameover = document.getElementById("gameover");
    const finalScore = document.getElementById("final-score");
    const finalLevel = document.getElementById("final-level");

    // „Ç≤„Éº„É†Â§âÊï∞
    let score = 0;
    let highscore = 0;
    let timeLeft = 60;
    let level = 1;
    let combo = 0;
    let maxCombo = 0;
    let gameInterval;
    let bgParticleInterval;
    let isPowerUpActive = false;
    let powerUpEndTime = 0;
    let characterX = window.innerWidth / 2;

    // „Çµ„Ç¶„É≥„ÉâË®≠ÂÆöÔºà„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞‰ªò„ÅçÔºâ
    let se, bgm;
    try {
      se = new Audio("kirarin.mp3");
      bgm = new Audio("bgm.mp3");
      bgm.loop = true;
      bgm.volume = 0.5;
    } catch (error) {
      se = { play: () => {}, currentTime: 0 };
      bgm = { play: () => Promise.resolve(), loop: true, volume: 0.5 };
    }

    // ÂàùÊúüÂåñ
    try {
      highscore = parseInt(localStorage.getItem("highscore")) || 0;
    } catch (error) {
      console.log("„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åõ„Çì");
    }
    highscoreDisplay.innerText = highscore;

    // ËÉåÊôØ„Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÁîüÊàê
    function createBackgroundParticle() {
      const particle = document.createElement("div");
      particle.className = "bg-particle";
      particle.style.left = Math.random() * window.innerWidth + "px";
      particle.style.width = particle.style.height = (Math.random() * 8 + 4) + "px";
      particle.style.animationDuration = (Math.random() * 10 + 8) + "s";
      document.body.appendChild(particle);

      setTimeout(() => {
        if (particle.parentNode) particle.remove();
      }, 20000);
    }

    // „Ç≠„É£„É©„ÇØ„Çø„Éº‰ΩçÁΩÆÊõ¥Êñ∞
    function updateCharacterPosition() {
      character.style.left = `${characterX}px`;
    }

    // „É¨„Éô„É´Ë®àÁÆó
    function calculateLevel() {
      return Math.floor(score / 100) + 1;
    }

    // Èõ£ÊòìÂ∫¶„Å´Âü∫„Å•„Åè„Ç¢„Ç§„ÉÜ„É†ÁîüÊàêÈñìÈöî
    function getSpawnRate() {
      return Math.max(200, 600 - (level * 30));
    }

    // „Çπ„Ç≥„Ç¢Êõ¥Êñ∞
    function updateScore(points = 1) {
      const previousLevel = level;
      
      if (isPowerUpActive) {
        points *= 2; // „Éë„ÉØ„Éº„Ç¢„ÉÉ„Éó‰∏≠„ÅØ2ÂÄç
      }
      
      score += points;
      combo++;
      scoreDisplay.innerText = score;
      comboDisplay.innerText = combo;
      
      // „É¨„Éô„É´„Ç¢„ÉÉ„Éó„ÉÅ„Çß„ÉÉ„ÇØ
      level = calculateLevel();
      levelDisplay.innerText = level;
      
      if (level > previousLevel) {
        showLevelUp();
      }

      // „Ç≥„É≥„ÉúË°®Á§∫
      if (combo > 1) {
        showComboPopup();
      }

      // ÊúÄÂ§ß„Ç≥„É≥„ÉúÊõ¥Êñ∞
      if (combo > maxCombo) {
        maxCombo = combo;
      }

      // „Çµ„Ç¶„É≥„ÉâÂÜçÁîü
      if (se.play) {
        se.currentTime = 0;
        se.play().catch(() => {});
      }

      // ÁâπÂà•„Ç®„Éï„Çß„ÇØ„Éà
      if (points >= 5) {
        showSpecialEffect();
      }
    }

    // „Ç≥„É≥„Éú„É™„Çª„ÉÉ„Éà
    function resetCombo() {
      combo = 0;
      comboDisplay.innerText = combo;
    }

    // „Ç≥„É≥„Éú„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóË°®Á§∫
    function showComboPopup() {
      comboPopup.textContent = `${combo} COMBO!`;
      comboPopup.style.display = 'block';
      setTimeout(() => {
        comboPopup.style.display = 'none';
      }, 1000);
    }

    // „É¨„Éô„É´„Ç¢„ÉÉ„ÉóË°®Á§∫
    function showLevelUp() {
      levelUpEffect.textContent = `LEVEL ${level}!`;
      levelUpEffect.style.display = 'block';
      setTimeout(() => {
        levelUpEffect.style.display = 'none';
      }, 2000);
    }

    // ÁâπÂà•„Ç®„Éï„Çß„ÇØ„Éà
    function showSpecialEffect() {
      scoreDisplay.style.transform = 'scale(1.3)';
      scoreDisplay.style.color = '#FFD700';
      setTimeout(() => {
        scoreDisplay.style.transform = 'scale(1)';
        scoreDisplay.style.color = '#5a3d5c';
      }, 500);
    }

    // „Éë„ÉØ„Éº„Ç¢„ÉÉ„ÉóÂäπÊûú
    function activatePowerUp() {
      isPowerUpActive = true;
      powerUpEndTime = Date.now() + 10000; // 10ÁßíÈñì
      character.classList.add('powerup');
      powerEffect.textContent = '‚ú®„ÉÄ„Éñ„É´„Çπ„Ç≥„Ç¢‰∏≠ÔºÅ';
      powerEffect.style.display = 'block';
      
      const countdown = setInterval(() => {
        const remaining = Math.ceil((powerUpEndTime - Date.now()) / 1000);
        if (remaining <= 0) {
          clearInterval(countdown);
          deactivatePowerUp();
        } else {
          powerEffect.textContent = `‚ú®„ÉÄ„Éñ„É´„Çπ„Ç≥„Ç¢‰∏≠ÔºÅ(${remaining}s)`;
        }
      }, 100);
    }

    // „Éë„ÉØ„Éº„Ç¢„ÉÉ„ÉóËß£Èô§
    function deactivatePowerUp() {
      isPowerUpActive = false;
      character.classList.remove('powerup');
      powerEffect.style.display = 'none';
    }

    // „Ç¢„Ç§„ÉÜ„É†ÁîüÊàê
    function createItem() {
      const item = document.createElement("div");
      const rand = Math.random();
      
      // „Ç¢„Ç§„ÉÜ„É†„Çø„Ç§„Éó„ÅÆÊ±∫ÂÆöÔºà„É¨„Éô„É´„Å´„Çà„Å£„Å¶Âá∫ÁèæÁéáÂ§âÂåñÔºâ
      if (rand < 0.05) { // 5% - ÁàÜÂºæ
        item.className = "bomb";
        item.dataset.type = "bomb";
        item.dataset.points = "-10";
      } else if (rand < 0.1) { // 5% - „Éë„ÉØ„Éº„Ç¢„ÉÉ„Éó
        item.className = "power-up";
        item.dataset.type = "powerup";
        item.dataset.points = "0";
      } else if (rand < 0.25) { // 15% - „Ç¥„Éº„É´„Éá„É≥Ëä±„Å≥„Çâ
        item.className = "petal golden";
        item.dataset.type = "golden";
        item.dataset.points = "5";
      } else if (rand < 0.45) { // 20% - ÁâπÂà•„Å™Ëä±„Å≥„Çâ
        item.className = "petal special";
        item.dataset.type = "special";
        item.dataset.points = "2";
      } else { // 55% - ÈÄöÂ∏∏„ÅÆËä±„Å≥„Çâ
        item.className = "petal";
        item.dataset.type = "normal";
        item.dataset.points = "1";
      }
      
      item.style.left = Math.random() * (window.innerWidth - 50) + "px";
      item.style.animationDuration = (2 + Math.random() * 2) + "s";
      document.body.appendChild(item);

      // Ë°ùÁ™ÅÂà§ÂÆö
      const checkCollision = setInterval(() => {
        const rect1 = item.getBoundingClientRect();
        const rect2 = character.getBoundingClientRect();
        
        if (
          rect1.top < rect2.bottom &&
          rect1.bottom > rect2.top &&
          rect1.left < rect2.right &&
          rect1.right > rect2.left
        ) {
          const type = item.dataset.type;
          const points = parseInt(item.dataset.points);
          
          if (type === "bomb") {
            // ÁàÜÂºæ„Å´ÂΩì„Åü„Å£„ÅüÂ†¥Âêà
            score = Math.max(0, score + points);
            scoreDisplay.innerText = score;
            resetCombo();
            // ÁîªÈù¢„ÇíËµ§„ÅèÁÇπÊªÖ
            document.body.style.background = '#ff6b6b';
            setTimeout(() => {
              document.body.style.background = 'linear-gradient(135deg, #ffeef5 0%, #ffe8f0 25%, #f8e8ff 50%, #e8f0ff 75%, #f0f8ff 100%)';
            }, 200);
          } else if (type === "powerup") {
            // „Éë„ÉØ„Éº„Ç¢„ÉÉ„Éó„Ç¢„Ç§„ÉÜ„É†
            activatePowerUp();
          } else {
            // Ëä±„Å≥„ÇâÁ≥ª„Ç¢„Ç§„ÉÜ„É†
            updateScore(points);
          }
          
          item.remove();
          clearInterval(checkCollision);
        }
      }, 50);

      // „Ç¢„Ç§„ÉÜ„É†ÂâäÈô§
      setTimeout(() => {
        if (item.parentNode) {
          item.remove();
          if (item.dataset.type !== "bomb") {
            resetCombo(); // Ëä±„Å≥„Çâ„ÇíÈÄÉ„Åó„ÅüÂ†¥Âêà„Ç≥„É≥„Éú„É™„Çª„ÉÉ„Éà
          }
        }
        clearInterval(checkCollision);
      }, 6000);
    }

    // „Ç≤„Éº„É†ÈñãÂßã
    function startGame() {
      if (bgm.play) bgm.play().catch(() => {});
      
      // „Ç¢„Ç§„ÉÜ„É†ÁîüÊàê
      gameInterval = setInterval(() => {
        createItem();
      }, getSpawnRate());

      // ËÉåÊôØ„Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÁîüÊàê
      bgParticleInterval = setInterval(createBackgroundParticle, 500);

      // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥
      const countdown = setInterval(() => {
        timeLeft--;
        timerDisplay.innerText = timeLeft;
        
        // Èõ£ÊòìÂ∫¶Ë™øÊï¥
        if (gameInterval) {
          clearInterval(gameInterval);
          gameInterval = setInterval(() => {
            createItem();
          }, getSpawnRate());
        }
        
        if (timeLeft <= 0) {
          clearInterval(countdown);
          clearInterval(gameInterval);
          clearInterval(bgParticleInterval);
          endGame();
        }
      }, 1000);
    }

    // „Ç≤„Éº„É†ÁµÇ‰∫Ü
    function endGame() {
      finalScore.innerText = score;
      finalLevel.innerText = level;
      gameover.style.display = "block";
      
      if (score > highscore) {
        try {
          localStorage.setItem("highscore", score);
          highscoreDisplay.innerText = score;
        } catch (error) {
          console.log("„Éè„Ç§„Çπ„Ç≥„Ç¢„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");
        }
      }
    }

    // „Ç≠„É£„É©„ÇØ„Çø„ÉºÊìç‰Ωú
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") {
        characterX -= 30;
      } else if (e.key === "ArrowRight") {
        characterX += 30;
      } else if (e.key === " ") {
        e.preventDefault();
        jump();
      }
      characterX = Math.max(60, Math.min(window.innerWidth - 60, characterX));
      updateCharacterPosition();
    });

    // „Ç∏„É£„É≥„ÉóÊ©üËÉΩ
    function jump() {
      if (!character.classList.contains("jump")) {
        character.classList.add("jump");
        setTimeout(() => character.classList.remove("jump"), 600);
      }
    }

    // „ÇØ„É™„ÉÉ„ÇØ„Åß„Ç∏„É£„É≥„Éó
    character.addEventListener("click", (e) => {
      e.preventDefault();
      jump();
    }, { passive: false });

    // „Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥
    const leftBtn = document.createElement("button");
    leftBtn.innerText = "‚óÄ";
    leftBtn.className = "control-btn";
    leftBtn.style.left = "20px";

    const rightBtn = document.createElement("button");
    rightBtn.innerText = "‚ñ∂";
    rightBtn.className = "control-btn";
    rightBtn.style.right = "20px";

    const jumpBtn = document.createElement("button");
    jumpBtn.innerText = "‚¨Ü";
    jumpBtn.className = "control-btn";
    jumpBtn.style.right = "90px";
    jumpBtn.style.background = "linear-gradient(145deg, rgba(147, 112, 219, 0.9), rgba(65, 105, 225, 0.8))";

    document.body.appendChild(leftBtn);
    document.body.appendChild(rightBtn);
    document.body.appendChild(jumpBtn);

    let moveInterval = null;

    function startMove(direction) {
      if (moveInterval) return;
      moveInterval = setInterval(() => {
        if (direction === "left") {
          characterX -= 15;
        } else if (direction === "right") {
          characterX += 15;
        }
        characterX = Math.max(60, Math.min(window.innerWidth - 60, characterX));
        updateCharacterPosition();
      }, 50);
    }

    function stopMove() {
      clearInterval(moveInterval);
      moveInterval = null;
    }

    // „Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„Éà
    leftBtn.addEventListener("touchstart", (e) => {
      e.preventDefault();
      startMove("left");
    }, { passive: false });

    rightBtn.addEventListener("touchstart", (e) => {
      e.preventDefault();
      startMove("right");
    }, { passive: false });

    jumpBtn.addEventListener("touchstart", (e) => {
      e.preventDefault();
      jump();
    }, { passive: false });

    leftBtn.addEventListener("touchend", (e) => {
      e.preventDefault();
      stopMove();
    }, { passive: false });

    rightBtn.addEventListener("touchend", (e) => {
      e.preventDefault();
      stopMove();
    }, { passive: false });

    // „Éû„Ç¶„Çπ„Ç§„Éô„É≥„Éà
    leftBtn.addEventListener("mousedown", () => startMove("left"));
    rightBtn.addEventListener("mousedown", () => startMove("right"));
    jumpBtn.addEventListener("mousedown", jump);
    leftBtn.addEventListener("mouseup", stopMove);
    rightBtn.addEventListener("mouseup", stopMove);
    leftBtn.addEventListener("mouseleave", stopMove);
    rightBtn.addEventListener("mouseleave", stopMove);

    // „Çπ„ÉØ„Ç§„ÉóÊìç‰Ωú
    let touchStartX = null;
    let touchStartY = null;

    document.addEventListener("touchstart", (e) => {
      touchStartX = e.changedTouches[0].clientX;
      touchStartY = e.changedTouches[0].clientY;
    }, { passive: true });

    document.addEventListener("touchend", (e) => {
      if (touchStartX === null || touchStartY === null) return;
      
      const deltaX = e.changedTouches[0].clientX - touchStartX;
      const deltaY = e.changedTouches[0].clientY - touchStartY;
      
      // ‰∏ä„Çπ„ÉØ„Ç§„Éó„Åß„Ç∏„É£„É≥„Éó
      if (Math.abs(deltaY) > Math.abs(deltaX) && deltaY < -50) {
        jump();
      }
      // Ê®™„Çπ„ÉØ„Ç§„Éó„ÅßÁßªÂãï
      else if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
        if (deltaX > 0) {
          characterX += 40;
        } else {
          characterX -= 40;
        }
        characterX = Math.max(60, Math.min(window.innerWidth - 60, characterX));
        updateCharacterPosition();
      }
      
      touchStartX = null;
      touchStartY = null;
    }, { passive: true });

    // „É™„Çµ„Ç§„Ç∫ÂØæÂøú
    window.addEventListener('resize', () => {
      characterX = Math.max(60, Math.min(window.innerWidth - 60, characterX));
      updateCharacterPosition();
    });

    // ÂàùÊúü‰ΩçÁΩÆË®≠ÂÆö
    updateCharacterPosition();

    // „Ç≤„Éº„É†ÈñãÂßã
    startGame();

    // Èü≥Ê•ΩÈñãÂßã„ÅÆ„Åü„ÇÅ„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
    document.body.addEventListener("click", () => {
      if (bgm.play) bgm.play().catch(() => {});
    }, { once: true });
     </script>
„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ</body>
</html>
